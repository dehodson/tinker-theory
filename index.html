<!doctype html>
<html>
<head>
	<style>
		body, html{
			height:100%;
			margin:0;
			color: #FFF;
			background-color: #333;
			font-family: "Helvetica", "Arial", sans-serif;
		}
		#main{
			height:80vmin;
			width: 80vmin;
			background-color: #DDD;
			position: absolute;
			top:0px;
			left:0px;
			right:0px;
			bottom:0px;
			margin:auto;
			border-radius: 3vmin;
		}
		#game-title{
			position: absolute;
			font-size:5vmin;
			top: -6vmin;
			width: 80vmin;
			text-align: center;
		}
		#turn{
			position: absolute;
			font-size: 3vmin;
			top:3vmin;
			left:5vmin;
			color:black;
		}
		#score{
			position: absolute;
			font-size: 3vmin;
			top:3vmin;
			right:5vmin;
			color:black;
		}
		#status{
			position: absolute;
			font-size: 3vmin;
			bottom: 33vmin;
			left: 0vmin;
			width: 80vmin;
			color: black;
			text-align: center;
		}
		#hand{
			position: absolute;
			bottom: 0px;
			left:   0px;
			width:  80vmin;
			height: 30vmin;
			background-color: #F33;
		}
		.card{
			position: absolute;
			height: 26vmin;
			width:  16vmin;
			margin: 1vmin;
			padding: 1vmin;
			background-color: #3F3;
			border-radius: 2vmin;
			color: black;
			font-size: 2vmin;
		}
		.card:hover{
			border: .5vmin solid #000;
			margin: .5vmin;
			z-index: 100;
		}
		.image{
			background-size: 100%;
			width:16vmin;
			height:10vmin;
		}
		.text{
			text-align: center;
		}
		.attack{
			position: absolute;
			bottom:-.5vmin;
			left:  -.5vmin;
			background-color: white;
			padding:1vmin;
			border-radius: 1vmin;
		}
		.card:hover .attack{
			left:   -1vmin;
			bottom: -1vmin;
			border-left:.5vmin solid #000;
			border-bottom:.5vmin solid #000;
		}
		.defense{
			position: absolute;
			bottom:-.5vmin;
			right: -.5vmin;
			background-color: white;
			padding:1vmin;
			border-radius: 1vmin;
		}
		.card:hover .defense{
			right:  -1vmin;
			bottom: -1vmin;
			border-right:.5vmin solid #000;
			border-bottom:.5vmin solid #000;

		}
		#your-card{
			position: absolute;
			top:10vmin;
			left:18vmin;
		}
		#enemy-card{
			position: absolute;
			top:10vmin;
			left:42vmin;
		}
	</style>
	<script type="text/javascript" src="/socket.io/socket.io.js"></script>
</head>
	<body onkeydown="keyPressed(event);">
		<div id="main">
			<div id="game-title">Tinker Theory 2017</div>
			<div id="turn">You're on the attack!</div>
			<div id="score">Score: <span id="score-points">0 - 0</span></div>
			<div id="your-card"  class="card"></div>
			<div id="enemy-card" class="card"></div>
			<div id="hand"></div>
			<div id="status">Waiting on an opponent...</div>
		</div>
	</body>
	<script type="text/javascript">
		var yourTurn = true;
		var canClick = true;
		var socket = io.connect('/');

		socket.emit("test");

		var hand = [];

		function makeCard(dict, id){
			var string = "<div class=\"card\" id=\""+id+"\" onclick=\"playCard(this)\">";
			   string += "<div class=\"title\" id=\""+id+"-title\">"+dict.title+"</div>";
			   string += "<div class=\"image\" id=\""+id+"-image\" style=\"background-image:url('images/"+dict.image+"')\"></div>";
			   string += "<div class=\"text\"  id=\""+id+"-text\" >"+dict.text+"</div>";
			   string += "<div class=\"attack\"  id=\""+id+"-attack\">"+dict.attack+"</div>";
			   string += "<div class=\"defense\"  id=\""+id+"-defense\">"+dict.defense+"</div></div>";
			return string;
		}

		function updateHand(){
			document.getElementById("hand").innerHTML = "";

			if(hand.length > 3){
				var offset = 0;
				var diff = 60 / (hand.length - 1);
			}else{
				var offset = (80 - (hand.length * 20)) / 2;
				var diff = 20;
			}

			for(var i = 0; i < hand.length; i++){
				document.getElementById("hand").innerHTML += makeCard(hand[i], "card-"+i);
				document.getElementById("card-"+i).style.left = (offset + (diff * i)) + "vmin";
			}
		}

		function updateScore(){
			document.getElementById("score-points").innerText = player.score + " - " + enemy.score;
		}

		function playCard(element){
			if(canClick){
				var cardId = parseInt(element.id.substring(5));

				if(!isNaN(cardId)){
					canClick = false;
					
					document.getElementById("status").innerText = "Waiting on your opponent to play a card.";

					window.socket.emit("play", {number: cardId});
				}
			}
		}

		socket.on('turn', function( data ) {
            if(data.bool){
				document.getElementById("turn").innerText = "You're on the attack!";
			}else{
				document.getElementById("turn").innerText = "You're on the defense!";
			}
        });

        socket.on('hand', function( data ) {
        	hand = data.hand;
            updateHand();
        });

        socket.on('can click', function() {
        	canClick = true;
        });

        socket.on('score', function( data ) {
        	document.getElementById("score-points").innerText = data.you + " - " + data.them;
        });

        socket.on('battle', function( data ) {
        	var yours  = document.getElementById("your-card");
        	var theirs = document.getElementById("enemy-card");

        	yours.outerHTML  = makeCard(data.yours, "your-card");
        	theirs.outerHTML = makeCard(data.theirs, "enemy-card");
        });

        socket.on('clear status', function (){
        	document.getElementById("status").innerText = "";
        });
	</script>
</html>